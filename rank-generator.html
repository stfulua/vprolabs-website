<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üéÆ Auto Rank Generator Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&family=Press+Start+2P&family=Russo+One&family=Black+Ops+One&family=Bungee&family=Quantico:wght@700&family=Montserrat:wght@800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            min-height: 100vh;
            padding: 10px;
        }

        .header {
            text-align: center;
            padding: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            margin-bottom: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .header h1 {
            font-size: 2em;
            background: linear-gradient(90deg, #00f260, #0575e6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }

        .mode-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: rgba(0,0,0,0.3);
            padding: 5px;
            border-radius: 12px;
        }

        .mode-tab {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            color: #888;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .mode-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            max-width: 1400px;
            margin: 0 auto;
        }

        @media (min-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        .panel {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }

        .panel-title {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: #00f260;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            font-size: 0.85em;
            color: #aaa;
            margin-bottom: 8px;
            font-weight: 600;
        }

        input[type="text"], select {
            width: 100%;
            padding: 12px;
            background: rgba(0,0,0,0.3);
            border: 2px solid rgba(255,255,255,0.1);
            color: white;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }

        input[type="text"]:focus, select:focus {
            outline: none;
            border-color: #00f260;
            background: rgba(0,0,0,0.5);
        }

        .gradient-presets {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-top: 8px;
        }

        @media (max-width: 600px) {
            .gradient-presets { grid-template-columns: repeat(3, 1fr); }
        }

        .preset-btn {
            height: 45px;
            border: 3px solid transparent;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        .preset-btn:hover { transform: translateY(-2px) scale(1.05); }
        .preset-btn.active { 
            border-color: #00f260; 
            box-shadow: 0 0 15px rgba(0,242,96,0.5);
        }
        .preset-btn.active::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            text-shadow: 0 0 5px black, 0 0 10px black;
            font-weight: bold;
        }

        .color-row {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        input[type="color"] {
            width: 60px;
            height: 50px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            background: none;
        }

        .preview-canvas {
            width: 100%;
            max-width: 400px;
            height: auto;
            background-image: 
                linear-gradient(45deg, #444 25%, transparent 25%), 
                linear-gradient(-45deg, #444 25%, transparent 25%), 
                linear-gradient(45deg, transparent 75%, #444 75%), 
                linear-gradient(-45deg, transparent 75%, #444 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            border-radius: 10px;
            border: 2px solid rgba(255,255,255,0.2);
            image-rendering: pixelated;
            display: block;
            margin: 0 auto;
        }

        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .btn-primary:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(102,126,234,0.4); }

        .btn-success {
            background: linear-gradient(135deg, #00f260 0%, #0575e6 100%);
            color: white;
        }
        .btn-success:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,242,96,0.4); }

        .btn-warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .ranks-list {
            max-height: 400px;
            overflow-y: auto;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 10px;
        }

        .rank-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            margin-bottom: 10px;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .rank-item:hover { border-color: rgba(255,255,255,0.2); }
        .rank-item img {
            width: 80px;
            height: 40px;
            object-fit: contain;
            image-rendering: pixelated;
            background: rgba(0,0,0,0.3);
            border-radius: 5px;
        }

        .rank-info { flex: 1; }
        .rank-name { font-weight: bold; font-size: 1.1em; }
        .rank-char { 
            font-family: monospace; 
            color: #00f260; 
            font-size: 0.9em;
            background: rgba(0,0,0,0.3);
            padding: 2px 8px;
            border-radius: 5px;
        }
        .rank-meta { font-size: 0.8em; color: #888; margin-top: 4px; }

        .delete-btn {
            background: #ff416c;
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #666;
            font-style: italic;
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .file-label {
            display: block;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border: 2px dashed rgba(255,255,255,0.3);
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-label:hover {
            background: rgba(255,255,255,0.15);
            border-color: #00f260;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .stat-box {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #00f260;
        }

        .stat-label {
            font-size: 0.8em;
            color: #888;
            margin-top: 5px;
        }

        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
            padding: 15px;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
        }

        input[type="checkbox"] {
            width: 24px;
            height: 24px;
            cursor: pointer;
        }

        .auto-rank-input {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .auto-rank-input input {
            flex: 1;
        }

        .auto-rank-input button {
            width: auto;
            padding: 12px 20px;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .power2-badge {
            display: inline-block;
            background: #00f260;
            color: black;
            padding: 2px 8px;
            border-radius: 5px;
            font-size: 0.75em;
            font-weight: bold;
            margin-left: 10px;
        }

        ::-webkit-scrollbar {
            width: 10px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.2);
            border-radius: 5px;
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.2);
            border-radius: 5px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.3);
        }
    </style>
</head>
<body>

    <div class="header">
        <h1>üéÆ AUTO RANK GENERATOR PRO</h1>
        <p>Generuj rangi Minecraft automatycznie z poprawnymi rozmiarami (potƒôga 2)</p>
    </div>

    <div class="mode-tabs">
        <button class="mode-tab active" onclick="setMode('manual')">‚úèÔ∏è Rƒôczny</button>
        <button class="mode-tab" onclick="setMode('auto')">‚ö° Automatyczny (Bulk)</button>
    </div>

    <div class="main-grid">
        <!-- LEWY PANEL -->
        <div class="panel">
            <div class="panel-title">‚öôÔ∏è Konfiguracja</div>
            
            <div id="manualMode">
                <div class="form-group">
                    <label>Nazwa rangi:</label>
                    <input type="text" id="rankName" placeholder="np. W≈ÅA≈öCICIEL" oninput="updatePreview()">
                </div>
            </div>

            <div id="autoMode" style="display: none;">
                <div class="form-group">
                    <label>Szybkie dodawanie (jedna nazwa na liniƒô):</label>
                    <textarea id="bulkNames" rows="4" style="width: 100%; padding: 12px; background: rgba(0,0,0,0.3); border: 2px solid rgba(255,255,255,0.1); color: white; border-radius: 10px; resize: vertical;" placeholder="ADMIN&#10;MODERATOR&#10;HELPER"></textarea>
                    <button class="btn btn-success" onclick="addBulkRanks()" style="margin-top: 10px;">‚ûï Dodaj wszystkie</button>
                </div>
            </div>

            <div class="form-group">
                <label>Czcionka:</label>
                <select id="fontStyle" onchange="updatePreview()">
                    <option value="VT323">VT323 (Pixel Classic)</option>
                    <option value="Press Start 2P">Press Start 2P (Retro)</option>
                    <option value="Russo One">Russo One (Bold)</option>
                    <option value="Black Ops One">Black Ops One (Military)</option>
                    <option value="Bungee">Bungee (Urban)</option>
                    <option value="Quantico">Quantico (Tech)</option>
                    <option value="Montserrat">Montserrat ExtraBold</option>
                </select>
            </div>

            <div class="form-group">
                <label>Styl kszta≈Çtu:</label>
                <select id="shapeStyle" onchange="updatePreview()">
                    <option value="chamfer">≈öciƒôte rogi (Minecraft)</option>
                    <option value="square">ProstokƒÖt</option>
                    <option value="rounded">ZaokrƒÖglony</option>
                </select>
            </div>

            <div class="form-group">
                <label>Wybierz gradient:</label>
                <div class="gradient-presets" id="gradientPresets"></div>
            </div>

            <div class="form-group">
                <label>Kolory (rƒôczna edycja):</label>
                <div class="color-row">
                    <input type="color" id="color1" value="#ff0000" oninput="updatePreview()">
                    <input type="color" id="color2" value="#ff8800" oninput="updatePreview()">
                </div>
            </div>

            <div class="form-group">
                <label>Kolor tekstu:</label>
                <input type="color" id="textColor" value="#ffffff" oninput="updatePreview()" style="width: 60px; height: 40px;">
            </div>

            <div class="checkbox-wrapper">
                <input type="checkbox" id="power2Check" checked onchange="updatePreview()">
                <label for="power2Check" style="margin: 0; cursor: pointer;">
                    Wymu≈õ rozmiar potƒôgi 2 (dla Minecraft 1.21+) <span class="power2-badge">ZALECANE</span>
                </label>
            </div>

            <div class="form-group" id="previewBox">
                <label>PodglƒÖd (skalowany do 128x32 dla MC):</label>
                <canvas id="previewCanvas" class="preview-canvas"></canvas>
            </div>

            <button class="btn btn-success" onclick="addCurrentRank()">üíæ Dodaj rangƒô do listy</button>
            
            <div class="file-input-wrapper" style="margin-top: 10px;">
                <input type="file" id="mgfLoad" accept=".mgf,.json" onchange="loadMGF(event)">
                <label for="mgfLoad" class="file-label">üìÇ Wczytaj .mgf / .json</label>
            </div>
        </div>

        <!-- PRAWY PANEL -->
        <div class="panel">
            <div class="panel-title">üìã Lista Rang <span id="rankCount" style="color: #888; font-size: 0.8em;">(0/44)</span></div>
            
            <div class="stats">
                <div class="stat-box">
                    <div class="stat-value" id="statCount">0</div>
                    <div class="stat-label">Rangi</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="statChars">64</div>
                    <div class="stat-label">Dostƒôpne</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="statSize">-</div>
                    <div class="stat-label">Rozmiar</div>
                </div>
            </div>

            <div class="ranks-list" id="ranksList">
                <div class="empty-state">Brak rang. Dodaj pierwszƒÖ!</div>
            </div>

            <div style="margin-top: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <button class="btn btn-warning" onclick="saveMGF()">üíæ Zapisz .mgf</button>
                <button class="btn btn-info" onclick="generateTexturePack()">üì¶ Generuj TexturePack</button>
            </div>
            
            <button class="btn btn-primary" onclick="downloadAllImages()" style="margin-top: 10px;">üñºÔ∏è Pobierz same PNG</button>
        </div>
    </div>

    <script>
        // UNICODE CHARACTERS - 64 slots (Ó†Ä to Ó†ø)
        const UNICODE_CHARS = [
            "Ó†Ä","Ó†Å","Ó†Ç","Ó†É","Ó†Ñ","Ó†Ö","Ó†Ü","Ó†á","Ó†à","Ó†â","Ó†ä","Ó†ã","Ó†å","Ó†ç","Ó†é","Ó†è",
            "Ó†ê","Ó†ë","Ó†í","Ó†ì","Ó†î","Ó†ï","Ó†ñ","Ó†ó","Ó†ò","Ó†ô","Ó†ö","Ó†õ","Ó†ú","Ó†ù","Ó†û","Ó†ü",
            "Ó††","Ó†°","Ó†¢","Ó†£","Ó†§","Ó†•","Ó†¶","Ó†ß","Ó†®","Ó†©","Ó†™","Ó†´","Ó†¨","Ó†≠","Ó†Æ","Ó†Ø",
            "Ó†∞","Ó†±","Ó†≤","Ó†≥","Ó†¥","Ó†µ","Ó†∂","Ó†∑","Ó†∏","Ó†π","Ó†∫","Ó†ª","Ó†º","Ó†Ω","Ó†æ","Ó†ø"
        ];

        // FILE NAMES mapping (first 32 are reserved, 32-44 are new from image)
        const FILE_NAMES = [
            "member-seav","media-seav","manager-seav","helper-seav","mvp-seav","mvpplus-seav","mvpplusplus-seav",
            "mod-seav","noob-seav","owner-seav","admin-seav","pro-seav","twitch-seav","og-seav","builder-seav",
            "vip-seav","vipplus-seav","dev-seav","designer-seav","god-seav","elite-seav","eliteplus-seav",
            "youtube-seav","broadcast-seav","partner-seav","npc-seav","twitchbyrg","vipbyrg","vipplusbyrg",
            "yellowbyrg","youtubebyrg","memberbyrg",
            // NEW ONES FROM IMAGE (32-44)
            "admin","chatmod","chill","elita","gracz","helper","moderator","owner","pomocnik","sponsor","technik","testhelper","vip",
            // NULL placeholders (45-63)
            "null","null","null","null","null","null","null","null","null","null",
            "null","null","null","null","null","null","null","null","null"
        ];

        const GRADIENTS = [
            {name: "Fire", c1: "#ff0000", c2: "#ff8800"},
            {name: "Ocean", c1: "#0066ff", c2: "#00ccff"},
            {name: "Forest", c1: "#228b22", c2: "#90ee90"},
            {name: "Purple", c1: "#667eea", c2: "#764ba2"},
            {name: "Sunset", c1: "#ff512f", c2: "#dd2476"},
            {name: "Gold", c1: "#ffd700", c2: "#ff8c00"},
            {name: "Ice", c1: "#00c6ff", c2: "#0072ff"},
            {name: "Magma", c1: "#ff416c", c2: "#ff4b2b"},
            {name: "Neon", c1: "#b3ffab", c2: "#12fff7"},
            {name: "Berry", c1: "#8e2de2", c2: "#4a00e0"},
            {name: "Citrus", c1: "#f12711", c2: "#f5af19"},
            {name: "Midnight", c1: "#232526", c2: "#414345"},
            {name: "Candy", c1: "#ff9a9e", c2: "#fecfef"},
            {name: "Rainbow", c1: "#ff0080", c2: "#40e0d0"},
            {name: "Blood", c1: "#8a0000", c2: "#ff0000"},
            {name: "Toxic", c1: "#a8e063", c2: "#56ab2f"},
            {name: "Royal", c1: "#141e30", c2: "#243b55"},
            {name: "Peach", c1: "#ffecd2", c2: "#fcb69f"},
            {name: "Cosmic", c1: "#20002c", c2: "#cbb4d4"},
            {name: "Lemon", c1: "#ffe259", c2: "#ffa751"}
        ];

        let ranks = [];
        let currentGradient = GRADIENTS[0];
        let currentMode = 'manual';

        // Load fonts
        Promise.all([
            document.fonts.load('30px "VT323"'),
            document.fonts.load('30px "Press Start 2P"'),
            document.fonts.load('30px "Russo One"'),
            document.fonts.load('30px "Black Ops One"'),
            document.fonts.load('30px "Bungee"'),
            document.fonts.load('30px "Quantico"'),
            document.fonts.load('30px "Montserrat"')
        ]).then(() => {
            initPresets();
            updatePreview();
        });

        function initPresets() {
            const container = document.getElementById('gradientPresets');
            GRADIENTS.forEach((g, i) => {
                const btn = document.createElement('div');
                btn.className = 'preset-btn';
                btn.style.background = `linear-gradient(135deg, ${g.c1} 0%, ${g.c2} 100%)`;
                btn.title = g.name;
                btn.onclick = () => selectGradient(i);
                container.appendChild(btn);
            });
            selectGradient(0);
        }

        function selectGradient(index) {
            currentGradient = GRADIENTS[index];
            document.getElementById('color1').value = currentGradient.c1;
            document.getElementById('color2').value = currentGradient.c2;
            document.querySelectorAll('.preset-btn').forEach((b, i) => {
                b.classList.toggle('active', i === index);
            });
            updatePreview();
        }

        function setMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('manualMode').style.display = mode === 'manual' ? 'block' : 'none';
            document.getElementById('autoMode').style.display = mode === 'auto' ? 'block' : 'none';
        }

        function getPowerOf2Size(textWidth) {
            const padding = 20;
            const height = 32; // Fixed height for MC
            let width = textWidth + (padding * 2);
            
            // Round up to nearest power of 2
            const powers = [64, 128, 256, 512];
            for (let p of powers) {
                if (width <= p) return { width: p, height };
            }
            return { width: 512, height };
        }

        function drawRankToCanvas(canvas, text, options = {}) {
            const ctx = canvas.getContext('2d');
            const fontStyle = options.font || 'VT323';
            const shape = options.shape || 'chamfer';
            const color1 = options.c1 || '#ff0000';
            const color2 = options.c2 || '#ff8800';
            const textColor = options.textColor || '#ffffff';
            const forcePower2 = options.power2 !== false;

            let fontSize = 24;
            if (fontStyle === 'Press Start 2P') fontSize = 14;
            else if (fontStyle === 'Montserrat') fontSize = 20;

            ctx.font = `bold ${fontSize}px "${fontStyle}"`;
            const textMetrics = ctx.measureText(text);
            
            let width, height;
            if (forcePower2) {
                const size = getPowerOf2Size(textMetrics.width);
                width = size.width;
                height = size.height;
            } else {
                width = textMetrics.width + 40;
                height = 32;
            }

            canvas.width = width;
            canvas.height = height;

            // Redraw with correct size
            ctx.font = `bold ${fontSize}px "${fontStyle}"`;
            ctx.textBaseline = 'middle';
            ctx.textAlign = 'center';

            // Background gradient
            const grad = ctx.createLinearGradient(0, 0, width, 0);
            grad.addColorStop(0, color1);
            grad.addColorStop(1, color2);
            ctx.fillStyle = grad;

            // Shape
            if (shape === 'chamfer') {
                const cut = Math.min(6, height/4);
                ctx.beginPath();
                ctx.moveTo(cut, 0);
                ctx.lineTo(width - cut, 0);
                ctx.lineTo(width, cut);
                ctx.lineTo(width, height - cut);
                ctx.lineTo(width - cut, height);
                ctx.lineTo(cut, height);
                ctx.lineTo(0, height - cut);
                ctx.lineTo(0, cut);
                ctx.closePath();
                ctx.fill();
                ctx.strokeStyle = "rgba(0,0,0,0.4)";
                ctx.lineWidth = 2;
                ctx.stroke();
            } else if (shape === 'rounded') {
                ctx.beginPath();
                ctx.roundRect(0, 0, width, height, 8);
                ctx.fill();
            } else {
                ctx.fillRect(0, 0, width, height);
                ctx.strokeStyle = "rgba(255,255,255,0.2)";
                ctx.lineWidth = 2;
                ctx.strokeRect(2, 2, width-4, height-4);
            }

            // Text shadow
            ctx.fillStyle = "rgba(0,0,0,0.8)";
            ctx.fillText(text, (width/2) + 1, (height/2) + 1);

            // Main text
            ctx.fillStyle = textColor;
            ctx.fillText(text, width/2, height/2);

            return { width, height };
        }

        function updatePreview() {
            const canvas = document.getElementById('previewCanvas');
            const text = document.getElementById('rankName').value || 'PREVIEW';
            const size = drawRankToCanvas(canvas, text.toUpperCase(), {
                font: document.getElementById('fontStyle').value,
                shape: document.getElementById('shapeStyle').value,
                c1: document.getElementById('color1').value,
                c2: document.getElementById('color2').value,
                textColor: document.getElementById('textColor').value,
                power2: document.getElementById('power2Check').checked
            });
            document.getElementById('statSize').textContent = `${size.width}x${size.height}`;
        }

        function addCurrentRank() {
            const name = document.getElementById('rankName').value.trim();
            if (!name) {
                alert('Wpisz nazwƒô rangi!');
                return;
            }
            addRank(name);
            document.getElementById('rankName').value = '';
            updatePreview();
        }

        function addBulkRanks() {
            const text = document.getElementById('bulkNames').value;
            const names = text.split('\n').map(n => n.trim()).filter(n => n);
            names.forEach(name => addRank(name));
            document.getElementById('bulkNames').value = '';
        }

        function addRank(name) {
            if (ranks.length >= 44) {
                alert('OsiƒÖgniƒôto limit 44 rang (tyle masz slot√≥w w JSON)!');
                return;
            }

            const canvas = document.createElement('canvas');
            const size = drawRankToCanvas(canvas, name.toUpperCase(), {
                font: document.getElementById('fontStyle').value,
                shape: document.getElementById('shapeStyle').value,
                c1: document.getElementById('color1').value,
                c2: document.getElementById('color2').value,
                textColor: document.getElementById('textColor').value,
                power2: true
            });

            const rank = {
                id: Date.now(),
                name: name.toUpperCase(),
                displayName: name,
                dataUrl: canvas.toDataURL('image/png'),
                width: size.width,
                height: size.height,
                settings: {
                    font: document.getElementById('fontStyle').value,
                    shape: document.getElementById('shapeStyle').value,
                    c1: document.getElementById('color1').value,
                    c2: document.getElementById('color2').value,
                    textColor: document.getElementById('textColor').value
                },
                char: UNICODE_CHARS[ranks.length],
                fileName: FILE_NAMES[ranks.length] || 'null'
            };

            ranks.push(rank);
            renderRanks();
        }

        function renderRanks() {
            const list = document.getElementById('ranksList');
            document.getElementById('rankCount').textContent = `(${ranks.length}/44)`;
            document.getElementById('statCount').textContent = ranks.length;
            document.getElementById('statChars').textContent = 64 - ranks.length;

            if (ranks.length === 0) {
                list.innerHTML = '<div class="empty-state">Brak rang. Dodaj pierwszƒÖ!</div>';
                return;
            }

            list.innerHTML = ranks.map((r, i) => `
                <div class="rank-item">
                    <img src="${r.dataUrl}" alt="${r.name}">
                    <div class="rank-info">
                        <div class="rank-name">${r.displayName}</div>
                        <div class="rank-char">${r.char} ‚Üí ${r.fileName}.png</div>
                        <div class="rank-meta">${r.settings.font} ‚Ä¢ ${r.width}x${r.height}</div>
                    </div>
                    <button class="delete-btn" onclick="deleteRank(${r.id})">üóëÔ∏è</button>
                </div>
            `).join('');
        }

        function deleteRank(id) {
            ranks = ranks.filter(r => r.id !== id);
            // Reassign chars and filenames
            ranks.forEach((r, i) => {
                r.char = UNICODE_CHARS[i];
                r.fileName = FILE_NAMES[i] || 'null';
            });
            renderRanks();
        }

        function saveMGF() {
            if (ranks.length === 0) {
                alert('Brak rang do zapisania!');
                return;
            }
            
            const mgfData = {
                version: "2.0",
                generator: "AutoRankPro",
                created: new Date().toISOString(),
                ranks: ranks.map(r => ({
                    name: r.displayName,
                    settings: r.settings
                }))
            };

            const blob = new Blob([JSON.stringify(mgfData, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ranks-config-${ranks.length}.mgf`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function loadMGF(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.ranks && Array.isArray(data.ranks)) {
                        // Clear current
                        ranks = [];
                        
                        // Load each rank
                        data.ranks.forEach(r => {
                            if (r.settings) {
                                document.getElementById('fontStyle').value = r.settings.font || 'VT323';
                                document.getElementById('shapeStyle').value = r.settings.shape || 'chamfer';
                                document.getElementById('color1').value = r.settings.c1 || '#ff0000';
                                document.getElementById('color2').value = r.settings.c2 || '#ff8800';
                                document.getElementById('textColor').value = r.settings.textColor || '#ffffff';
                            }
                            addRank(r.name);
                        });
                        
                        alert(`Wczytano ${data.ranks.length} rang!`);
                    } else {
                        alert('Nieprawid≈Çowy format pliku MGF!');
                    }
                } catch (err) {
                    alert('B≈ÇƒÖd wczytywania: ' + err.message);
                }
            };
            reader.readAsText(file);
        }

        async function generateTexturePack() {
            if (ranks.length === 0) {
                alert('Brak rang do wygenerowania!');
                return;
            }

            const zip = new JSZip();
            
            // Create folder structure
            const assets = zip.folder("assets").folder("minecraft");
            const textures = assets.folder("textures").folder("ranks");
            const font = assets.folder("font");

            // Generate JSON providers
            const providers = ranks.map((r, i) => ({
                type: "bitmap",
                file: `minecraft:ranks/${r.fileName}.png`,
                ascent: 7,
                height: 7,
                chars: [r.char]
            }));

            // Fill remaining slots with null
            for (let i = ranks.length; i < 64; i++) {
                providers.push({
                    type: "bitmap",
                    file: "minecraft:ranks/null.png",
                    ascent: 7,
                    height: 7,
                    chars: [UNICODE_CHARS[i]]
                });
            }

            const fontJson = { providers };
            font.file("default.json", JSON.stringify(fontJson, null, 4));

            // Add images
            ranks.forEach(r => {
                const base64 = r.dataUrl.split(',')[1];
                textures.file(`${r.fileName}.png`, base64, {base64: true});
            });

            // Add null.png (1x1 transparent)
            const nullPng = "iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==";
            textures.file("null.png", nullPng, {base64: true});

            // pack.mcmeta
            const mcmeta = {
                pack: {
                    pack_format: 46,
                    description: "    ¬ßb¬ßlChill¬ßf¬ßlBlock - Auto Generated Ranks"
                }
            };
            zip.file("pack.mcmeta", JSON.stringify(mcmeta, null, 4));

            // Generate ZIP
            const content = await zip.generateAsync({type: "blob"});
            const url = URL.createObjectURL(content);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ChillBlock-Ranks-${ranks.length}.zip`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function downloadAllImages() {
            if (ranks.length === 0) return;
            
            ranks.forEach((r, i) => {
                setTimeout(() => {
                    const a = document.createElement('a');
                    a.href = r.dataUrl;
                    a.download = `${r.fileName}.png`;
                    a.click();
                }, i * 100);
            });
        }

        // Init
        updatePreview();
    </script>
</body>
</html>
